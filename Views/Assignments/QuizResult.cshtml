@model CourseManagement.Models.QuizResultViewModel

@{
    ViewData["Title"] = "Kết quả bài thi";
}

<div class="container mt-4">
    <h2 class="mb-4">Kết quả bài thi: @Model.AssignmentTitle</h2>

    <!-- Hiển thị tổng kết -->
    <div class="card mb-4 border-primary">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h4 class="text-primary">
                        <i class="bi bi-check-circle"></i>
                        Số câu đúng: <strong>@Model.CorrectAnswers / @Model.TotalQuestions</strong>
                    </h4>
                </div>
                <div class="col-md-6 text-end">
                    <h4 class="text-success">
                        <i class="bi bi-star-fill"></i>
                        Điểm số: <strong>@Model.Score.ToString("F2") / @Model.MaxScore.ToString("F2")</strong>
                    </h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Hiển thị chi tiết từng câu hỏi -->
    <h4 class="mb-3">Chi tiết các câu hỏi:</h4>

    @for (int i = 0; i < Model.QuestionResults.Count; i++)
    {
        var question = Model.QuestionResults[i];
        var questionNumber = i + 1;

        <div class="card mb-3 @(question.IsCorrect ? "border-success" : "border-danger")">
            <div class="card-header @(question.IsCorrect ? "bg-success bg-opacity-10" : "bg-danger bg-opacity-10")">
                <h5 class="mb-0">
                    @if (question.IsCorrect)
                    {
                        <i class="bi bi-check-circle-fill text-success"></i>
                    }
                    else
                    {
                        <i class="bi bi-x-circle-fill text-danger"></i>
                    }
                    Câu @questionNumber: @question.Content
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-2">
                    <strong>Các đáp án:</strong>
                </div>
                <div class="list-group">
                    @foreach (var option in question.Options)
                    {
                        var isCorrectAnswer = question.CorrectAnswers.Contains(option);
                        var isStudentAnswer = question.StudentAnswers.Contains(option);

                        var bgClass = "";
                        var textClass = "";
                        var icon = "";

                        if (isCorrectAnswer && isStudentAnswer)
                        {
                            // Học viên chọn đúng
                            bgClass = "bg-success bg-opacity-25 border-success";
                            textClass = "text-success fw-bold";
                            icon = "<i class='bi bi-check-circle-fill text-success'></i>";
                        }
                        else if (isCorrectAnswer && !isStudentAnswer)
                        {
                            // Đáp án đúng nhưng học viên không chọn
                            bgClass = "bg-success bg-opacity-10 border-success";
                            textClass = "text-success";
                            icon = "<i class='bi bi-check-circle text-success'></i>";
                        }
                        else if (!isCorrectAnswer && isStudentAnswer)
                        {
                            // Học viên chọn sai
                            bgClass = "bg-danger bg-opacity-25 border-danger";
                            textClass = "text-danger fw-bold";
                            icon = "<i class='bi bi-x-circle-fill text-danger'></i>";
                        }
                        else
                        {
                            // Đáp án không liên quan
                            bgClass = "";
                            textClass = "";
                            icon = "<i class='bi bi-circle'></i>";
                        }

                        <div class="list-group-item @bgClass">
                            <div class="d-flex align-items-center">
                                <span class="me-2">@Html.Raw(icon)</span>
                                <span class="@textClass">@option</span>
                                @if (isStudentAnswer)
                                {
                                    <span class="badge bg-info ms-2">Bạn đã chọn</span>
                                }
                                @if (isCorrectAnswer)
                                {
                                    <span class="badge bg-success ms-2">Đáp án đúng</span>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    }

    <!-- Nút quay lại -->
    <div class="mt-4 mb-5">
        <a asp-action="Details" asp-route-id="@Model.AssignmentId" class="btn btn-primary">
            <i class="bi bi-arrow-left"></i> Quay lại bài tập
        </a>
    </div>
</div>

<style>
    .bg-opacity-10 {
        --bs-bg-opacity: 0.1;
    }

    .bg-opacity-25 {
        --bs-bg-opacity: 0.25;
    }
</style>